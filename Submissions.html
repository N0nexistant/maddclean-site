<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Form Submissions</title>
  <style>
    :root {
      --primary-color: #1e3a8a;
      --secondary-color: #3b82f6;
      --accent-color: #10b981;
      --bg-color: #f9fafb;
      --text-color: #111827;

      /* Light background colors for appointments */
      --color-1: #bfdbfe; /* light blue */
      --color-2: #bbf7d0; /* light green */
      --color-3: #fecaca; /* light red */
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: var(--bg-color);
      color: var(--text-color);
    }

    header {
      background-color: var(--primary-color);
      color: white;
      padding: 1.5rem;
      text-align: center;
    }

    .container {
      max-width: 800px;
      margin: 2rem auto;
      padding: 1.5rem;
      background: white;
      border-radius: 12px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.05);
    }

    h2 {
      color: var(--primary-color);
      margin-bottom: 1rem;
    }

    .search-bar {
      margin-bottom: 1.5rem;
    }

    .search-bar input {
      width: 100%;
      padding: 0.75rem 1rem;
      border: 1px solid #d1d5db;
      border-radius: 8px;
      font-size: 1rem;
    }

    .submission-list {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .submission {
      border-radius: 8px;
      padding: 1rem;
      font-size: 0.95rem;
      box-shadow: 0 2px 6px rgba(0,0,0,0.05);
    }

    .submission.bg-1 {
      background-color: var(--color-1);
    }

    .submission.bg-2 {
      background-color: var(--color-2);
    }

    .submission.bg-3 {
      background-color: var(--color-3);
    }

    .submission p {
      margin: 0.25rem 0;
    }

    .actions {
      margin-top: 0.75rem;
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
    }

    .actions button {
      padding: 0.35rem 0.75rem;
      border: none;
      border-radius: 4px;
      font-size: 0.85rem;
      cursor: pointer;
      color: white;
      font-weight: bold;
      transition: background-color 0.3s ease;
    }

    .actions .edit-btn {
      background-color: var(--secondary-color);
    }

    .actions .edit-btn:hover {
      background-color: #2563eb;
    }

    .actions .delete-btn {
      background-color: #ef4444;
    }

    .actions .delete-btn:hover {
      background-color: #dc2626;
    }

    .actions .calendar-btn {
      background-color: #a855f7;
    }

    .actions .calendar-btn:hover {
      background-color: #9333ea;
    }

    .empty-state {
      text-align: center;
      color: #6b7280;
      font-style: italic;
    }

    @media (max-width: 600px) {
      .container {
        margin: 1rem;
        padding: 1rem;
      }

      .submission {
        font-size: 0.85rem;
      }

      .actions button {
        flex: 1 1 45%;
        text-align: center;
      }
    }
  </style>
</head>
<body>

<header>
  <h1>Form Submissions</h1>
  <p>View, edit, or delete your auto detailing bookings</p>
</header>

<div class="container">
  <div class="search-bar">
    <input type="text" id="search-input" placeholder="Search by name..." oninput="loadSubmissions()">
  </div>

  <h2>Booking Submissions</h2>

  <div class="submission-list" id="submission-list">
    <!-- Booking submissions will appear here -->
  </div>
</div>

<script>
  function loadSubmissions() {
    const submissionList = document.getElementById('submission-list');
    const searchQuery = document.getElementById('search-input').value.toLowerCase();
    const submissions = JSON.parse(localStorage.getItem('bookings')) || [];

    submissionList.innerHTML = '';

    // Filter by name
    const filtered = submissions.filter(booking =>
      booking.name?.toLowerCase().includes(searchQuery)
    );

    if (filtered.length === 0 && searchQuery === '') {
      submissionList.innerHTML = '<p class="empty-state">No submissions found.</p>';
      return;
    }

    filtered.forEach((booking, index) => {
      const colorIndex = (index % 3) + 1; // cycle through 1, 2, 3

      const div = document.createElement('div');
      div.className = `submission bg-${colorIndex}`;
      div.innerHTML = `
        <p><strong>Name:</strong> ${booking.name}</p>
        <p><strong>Service:</strong> ${capitalizeFirstLetter(booking.package)}</p>
        <p><strong>Vehicle:</strong> ${capitalizeFirstLetter(booking.vehicle)}</p>
        <p><strong>Date:</strong> ${booking.date}</p>
        <p><strong>Time:</strong> ${booking.time}</p>
        <div class="actions">
          <button class="edit-btn" onclick="openEditModal(${index})">Edit</button>
          <button class="delete-btn" onclick="deleteSubmission(${index})">Delete</button>
          <button class="calendar-btn" onclick="addToGoogleCalendar(${index})">Calendar</button>
        </div>
      `;
      submissionList.appendChild(div);
    });
  }

  function openEditModal(index) {
    window.location.href = 'edit-booking.html?id=' + index;
  }

  function deleteSubmission(index) {
    if (confirm("Are you sure you want to delete this submission?")) {
      const bookings = JSON.parse(localStorage.getItem('bookings')) || [];
      bookings.splice(index, 1);
      localStorage.setItem('bookings', JSON.stringify(bookings));
      loadSubmissions();
    }
  }

  function addToGoogleCalendar(index) {
    const booking = JSON.parse(localStorage.getItem('bookings'))[index];
    const eventTitle = `Auto Detailing - ${capitalizeFirstLetter(booking.package)}`;
    const location = encodeURIComponent(booking.address);
    const dateParts = booking.date.split(' ');
    const [month, day, year] = dateParts.slice(1, 4);
    const monthMap = {
      Jan: '01', Feb: '02', Mar: '03', Apr: '04',
      May: '05', Jun: '06', Jul: '07', Aug: '08',
      Sep: '09', Oct: '10', Nov: '11', Dec: '12'
    };
    const formattedDate = `${year}${monthMap[month]}${day.padStart(2, '0')}`;
    const [startTime, period] = booking.time.split(' ');
    const [hourStr, minuteStr] = startTime.split(':');
    let hour = parseInt(hourStr);
    if (period === 'PM' && hour < 12) hour += 12;
    if (period === 'AM' && hour === 12) hour = 0;
    const formattedTime = `${hour.toString().padStart(2, '0')}${minuteStr}`;
    const start = `${formattedDate}T${formattedTime}00`;
    const end = `${formattedDate}T${parseInt(formattedTime) + 1}00`;

    const googleCalendarUrl = `https://www.google.com/calendar/render?action=TEMPLATE&text=${encodeURIComponent(eventTitle)}&dates=${start}/${end}&location=${location}`;
    window.open(googleCalendarUrl, '_blank');
  }

  function capitalizeFirstLetter(string) {
    return string.charAt(0).toUpperCase() + string.slice(1);
  }

  window.onload = () => {
    loadSubmissions();
  };
</script>

</body>
</html>